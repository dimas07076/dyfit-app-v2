import{c as W,j as e,B as n,n as q,r as d,o as V,m as J,I as A,p as Y,q as Z,C as ee,a as se,b as ae,M as ie,L as E,e as re,A as oe,f as ne,g as te,h as le,i as ce,k as S,l as F}from"./index-BzLV8CNE.js";import{u as me}from"./useQuery-PwrN8lgt.js";import{u as P}from"./useMutation-CMAM4n7S.js";import{T as de,a as xe,b as N,c as w,d as ue,e as x}from"./table-C_2_dIR3.js";import{B as R}from"./badge-mwLuO-R-.js";import{S as p}from"./skeleton-DvEZY-df.js";import{D as $,a as _,b as B,c as H,d as Q,e as T}from"./dialog-Cc9arakq.js";import{E as z}from"./ErrorMessage-CKvNOnls.js";import{A as he,E as pe}from"./AlunoViewModal-CisxOwlQ.js";import{u as je,t as fe,o as ve,s as ge,l as Ce}from"./types-BCbViMJN.js";import{F as Ne,a as we,b as ye,c as be,d as ke,e as Se}from"./form-Bay0436k.js";import{C as Ae}from"./copy-CQImoFod.js";import{S as Ee}from"./RotinaFormModal-Ov1nMD2j.js";import{P as Te}from"./tabs-Dt_cpVbU.js";import{E as U}from"./eye-DbA9ViTj.js";import{P as G}from"./pencil-DF3fT-z6.js";import"./triangle-alert-BMd-Rj3a.js";import"./progress-37Updk6C.js";import"./VideoPlayerModal-DmKj2Fh1.js";import"./bar-chart-Bj7A1Ztz.js";import"./circle-check-DMXSzY4S.js";import"./weight-DLv2WyAW.js";import"./calendar-days-Degg0IRE.js";import"./square-pen-DXG1TAJA.js";import"./label-ErXilaHi.js";import"./info-CBDjHlMF.js";import"./clock-Ds75S8Ae.js";import"./circle-play-CwwuRuoJ.js";import"./select-WeAdnBMh.js";import"./textarea-Bgva5FCm.js";import"./trash-2-CwwKKaCS.js";import"./arrow-left-CY9mcJgZ.js";/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=W("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function De({isOpen:a,onClose:r,onConfirm:t,titulo:l="Confirmação",mensagem:o="Tem certeza que deseja continuar?",textoConfirmar:i="Confirmar",textoCancelar:u="Cancelar",isLoadingConfirm:m=!1}){return e.jsx($,{open:a,onOpenChange:j=>!j&&r(),children:e.jsxs(_,{className:"max-w-md w-full p-6 rounded-lg bg-background shadow-lg space-y-4",children:[e.jsxs(B,{className:"text-center sm:text-left",children:[" ",e.jsxs(H,{className:"text-lg font-semibold",children:[" ",l]}),typeof o=="string"?e.jsx(Q,{className:"text-sm text-muted-foreground pt-2",children:o}):e.jsx("div",{className:"text-sm text-muted-foreground pt-2",children:o})]}),e.jsxs(T,{className:"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 pt-2",children:[" ",e.jsx(n,{variant:"outline",onClick:r,disabled:m,children:u}),e.jsxs(n,{variant:"destructive",onClick:t,disabled:m,children:[m&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),i]})]})]})})}function Ie(){const[a,r]=d.useState(!1),[t,l]=d.useState({}),o=m=>{l(m),r(!0)},i=()=>{r(!1)};return{isOpen:a,options:t,openConfirmDialog:o,closeConfirmDialog:i,confirm:()=>{t.onConfirm&&t.onConfirm(),i()}}}const Me=ve({email:ge().email("Se preenchido, deve ser um e-mail válido.").optional().or(Ce(""))}),Oe=({isOpen:a,onClose:r})=>{const{toast:t}=V(),[l,o]=d.useState("form"),[i,u]=d.useState(null),[m,j]=d.useState(!1),h=je({resolver:fe(Me),defaultValues:{email:""}});d.useEffect(()=>{a||setTimeout(()=>{h.reset(),o("form"),u(null),j(!1)},300)},[a,h]);const v=P({mutationFn:c=>J("POST","/api/aluno/convite",{emailConvidado:c.email||void 0}),onSuccess:c=>{u(c.linkConvite),o("success")},onError:c=>{t({variant:"destructive",title:"Erro ao gerar convite",description:c.message})}}),y=c=>{v.mutate(c)},g=()=>{i&&navigator.clipboard.writeText(i).then(()=>{j(!0),t({title:"Sucesso!",description:"Link copiado para a área de transferência."}),setTimeout(()=>j(!1),2e3)})},b=()=>{h.reset(),o("form"),u(null)};return e.jsx($,{open:a,onOpenChange:r,children:e.jsxs(_,{children:[e.jsxs(B,{children:[e.jsx(H,{children:"Convidar Novo Aluno"}),e.jsx(Q,{children:l==="form"?"Insira o e-mail do aluno (opcional) ou gere um link de convite genérico.":"Link de convite gerado! Envie para o seu aluno."})]}),l==="form"&&e.jsx(Ne,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(y),className:"space-y-4 py-4",children:[e.jsx(we,{control:h.control,name:"email",render:({field:c})=>e.jsxs(ye,{children:[e.jsx(be,{children:"E-mail do Aluno (Opcional)"}),e.jsx(ke,{children:e.jsx(A,{placeholder:"email@exemplo.com",...c})}),e.jsx(Se,{})]})}),e.jsxs(T,{children:[e.jsx(n,{variant:"outline",type:"button",onClick:r,children:"Cancelar"}),e.jsxs(n,{type:"submit",disabled:v.isPending,children:[v.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Gerar Link"]})]})]})}),l==="success"&&i&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:i,readOnly:!0,className:"flex-1"}),e.jsx(n,{size:"icon",onClick:g,children:m?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(Ae,{className:"h-4 w-4"})})]}),e.jsxs(T,{children:[e.jsx(n,{variant:"outline",onClick:b,children:"Convidar Outro"}),e.jsx(n,{onClick:r,children:"Fechar"})]})]})]})})},Le=({student:a,onView:r,onDelete:t})=>{const l=o=>{const i=o.split(" ").filter(Boolean);return i.length>1?`${i[0][0]}${i[i.length-1][0]}`.toUpperCase():i[0]?i[0].substring(0,2).toUpperCase():"?"};return e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(oe,{children:e.jsx(ne,{children:l(a.nome)})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm",children:a.nome}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{variant:a.status==="active"?"success":"destructive",className:"hidden sm:inline-flex",children:a.status==="active"?"Ativo":"Inativo"}),e.jsxs(te,{children:[e.jsx(le,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"icon",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(ce,{align:"end",children:[e.jsxs(S,{onClick:()=>r(a),children:[e.jsx(U,{className:"mr-2 h-4 w-4"})," Visualizar"]}),e.jsx(S,{asChild:!0,children:e.jsxs(E,{href:`/alunos/editar/${a._id}`,children:[e.jsx(G,{className:"mr-2 h-4 w-4"})," Editar"]})}),e.jsxs(S,{className:"text-destructive",onClick:()=>t(a),children:[e.jsx(K,{className:"mr-2 h-4 w-4"})," Remover"]})]})]})]})]})};function us(){const{toast:a}=V(),r=Z(),{isOpen:t,options:l,openConfirmDialog:o,closeConfirmDialog:i,confirm:u}=Ie(),[m,j]=d.useState(""),[h,v]=d.useState(null),[y,g]=d.useState(!1),[b,c]=d.useState(!1),{data:X=[],isLoading:f,isError:C,error:D}=me({queryKey:["/api/aluno/gerenciar"],queryFn:()=>F("/api/aluno/gerenciar"),retry:1}),I=P({mutationFn:s=>F(`/api/aluno/gerenciar/${s}`,{method:"DELETE"}),onSuccess:()=>{a({title:"Aluno Removido",description:"O aluno foi removido com sucesso."}),r.invalidateQueries({queryKey:["/api/aluno/gerenciar"]})},onError:s=>{a({variant:"destructive",title:"Erro ao Remover",description:s.message||"Não foi possível remover o aluno."})},onSettled:()=>i()}),M=X.filter(s=>(s.nome||"").toLowerCase().includes(m.toLowerCase())||(s.email||"").toLowerCase().includes(m.toLowerCase())),O=s=>{o({titulo:"Remover Aluno",mensagem:`Tem certeza que deseja remover o aluno ${s.nome}?`,onConfirm:()=>I.mutate(s._id)})},L=s=>{v(s),g(!0)};return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8",children:[e.jsxs(ee,{className:"border shadow-sm overflow-hidden bg-white dark:bg-gray-900",children:[e.jsxs(se,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between px-6 py-4 border-b",children:[e.jsx(ae,{className:"text-xl font-semibold",children:"Alunos"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-2 sm:mt-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(A,{type:"search",placeholder:"Pesquisar...",className:"pl-9 w-full sm:w-64",value:m,onChange:s=>j(s.target.value)})]}),e.jsxs(n,{variant:"outline",onClick:()=>c(!0),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Convidar Aluno"]}),e.jsx(E,{href:"/alunos/novo",children:e.jsxs(n,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"})," Adicionar Aluno"]})})]})]}),e.jsxs(re,{className:"p-0",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(de,{children:[e.jsx(xe,{className:"bg-gray-50 dark:bg-gray-800/50",children:e.jsxs(N,{children:[e.jsx(w,{className:"pl-6",children:"Aluno"}),e.jsx(w,{children:"Email"}),e.jsx(w,{children:"Status"}),e.jsx(w,{className:"text-right pr-6",children:"Ações"})]})}),e.jsxs(ue,{className:"divide-y",children:[f&&[...Array(5)].map((s,k)=>e.jsxs(N,{children:[e.jsx(x,{className:"pl-6 py-4",children:e.jsx(p,{className:"h-4 w-32"})}),e.jsx(x,{children:e.jsx(p,{className:"h-4 w-48"})}),e.jsx(x,{children:e.jsx(p,{className:"h-6 w-16"})}),e.jsx(x,{className:"text-right pr-6",children:e.jsx(p,{className:"h-8 w-24"})})]},`skeleton-table-${k}`)),C&&!f&&e.jsx(N,{children:e.jsx(x,{colSpan:4,children:e.jsx(z,{title:"Erro ao Carregar",message:D.message})})}),!f&&!C&&M.map(s=>e.jsxs(N,{className:"hover:bg-gray-50/50",children:[e.jsx(x,{className:"pl-6 font-medium",children:s.nome}),e.jsx(x,{className:"text-muted-foreground",children:s.email}),e.jsx(x,{children:e.jsx(R,{variant:s.status==="active"?"success":"destructive",children:s.status==="active"?"Ativo":"Inativo"})}),e.jsx(x,{className:"pr-6 text-right",children:e.jsxs("div",{className:"flex justify-end items-center space-x-1",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>L(s),title:"Visualizar",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"icon",asChild:!0,title:"Editar",children:e.jsx(E,{href:`/alunos/editar/${s._id}`,children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx(n,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>O(s),title:"Remover",children:e.jsx(K,{className:"h-4 w-4"})})]})})]},s._id))]})]})}),e.jsxs("div",{className:"md:hidden",children:[f&&[...Array(5)].map((s,k)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{className:"h-4 w-28"}),e.jsx(p,{className:"h-3 w-36"})]})]}),e.jsx(p,{className:"h-8 w-8"})]},`skeleton-card-${k}`)),C&&!f&&e.jsx(z,{title:"Erro ao Carregar",message:D.message}),!f&&!C&&M.map(s=>e.jsx(Le,{student:s,onView:L,onDelete:O},s._id))]})]})]}),e.jsx(he,{aluno:h,open:y,onOpenChange:g}),e.jsx(De,{isOpen:t,onClose:i,onConfirm:u,titulo:l.titulo,mensagem:l.mensagem,isLoadingConfirm:I.isPending}),e.jsx(Oe,{isOpen:b,onClose:()=>c(!1)})]})}export{us as default};
