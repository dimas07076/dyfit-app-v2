import{c as J,r as i,o as K,m as y,j as e,G as Q,C as L,a as A,b as S,d as G,e as R,I as v,B as p,n as j,S as V,J as k,K as w,p as W,N as T}from"./index-BzLV8CNE.js";import{L as E}from"./label-ErXilaHi.js";import{T as X,f as Y,a as Z,b as $,c as l,d as ee,e as d}from"./table-C_2_dIR3.js";import{A as ae,a as se,b as re,c as te,d as ie,e as oe,f as ne,g as le,h as de}from"./alert-dialog-Cli0ldNh.js";import{C as z}from"./copy-CQImoFod.js";import{T as ce}from"./trash-2-CwwKKaCS.js";import{f as xe}from"./format-Cj1jUzCS.js";import{p as me}from"./pt-BR-C0EKqbj-.js";/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=J("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Ne=()=>{const[s,F]=i.useState({emailConvidado:"",diasParaExpirar:7,roleConvidado:"Personal Trainer"}),[h,P]=i.useState(null),[c,u]=i.useState(!1),[B,f]=i.useState(!1),[x,H]=i.useState([]),[g,D]=i.useState(!1),[n,C]=i.useState(null),{toast:r}=K(),b=window.location.origin,m=i.useCallback(async()=>{D(!0);try{const a=await y("GET","/api/admin/convites/personal");H(a)}catch(a){r({title:"Erro ao Buscar Convites",description:a.message||"Não foi possível carregar a lista de convites.",variant:"destructive"})}finally{D(!1)}},[r]);i.useEffect(()=>{m()},[m]);const N=a=>{const{name:t,value:o}=a.target;F(_=>({..._,[t]:t==="diasParaExpirar"?o===""?void 0:Number(o):o}))},M=async a=>{a.preventDefault(),u(!0),P(null),f(!1);try{const t={roleConvidado:s.roleConvidado||"Personal Trainer"};s.emailConvidado&&s.emailConvidado.trim()!==""&&(t.emailConvidado=s.emailConvidado.trim()),s.diasParaExpirar!==void 0&&s.diasParaExpirar>0&&(t.diasParaExpirar=s.diasParaExpirar);const o=await y("POST","/api/admin/convites/personal",t);P(o.linkConvite),r({title:"Sucesso!",description:o.mensagem||"Convite criado e link gerado."}),m()}catch(t){const o=t.message||"Falha ao criar convite. Tente novamente.";r({title:"Erro ao Criar Convite",description:o,variant:"destructive"})}finally{u(!1)}},I=()=>{h&&navigator.clipboard.writeText(h).then(()=>{f(!0),r({description:"Link copiado para a área de transferência!"}),setTimeout(()=>f(!1),2e3)}).catch(()=>{r({description:"Erro ao copiar o link.",variant:"destructive"})})},O=async()=>{if(n){u(!0);try{await y("DELETE",`/api/admin/convites/personal/${n._id}`),r({title:"Convite Revogado",description:`O convite para ${n.emailConvidado||"convidado genérico"} foi revogado.`}),m()}catch(a){r({title:"Erro ao Revogar Convite",description:a.message||"Não foi possível revogar o convite.",variant:"destructive"})}finally{u(!1),C(null)}}},U=a=>{if(!a)return"N/A";try{return xe(new Date(a),"dd/MM/yyyy 'às' HH:mm",{locale:me})}catch{return"Data inválida"}},q=a=>{switch(a){case"pendente":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-yellow-800 bg-yellow-100 rounded-full dark:bg-yellow-700 dark:text-yellow-100",children:"Pendente"});case"utilizado":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full dark:bg-green-700 dark:text-green-100",children:"Utilizado"});case"expirado":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-red-800 bg-red-100 rounded-full dark:bg-red-700 dark:text-red-100",children:"Expirado"});default:return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-100 rounded-full dark:bg-gray-700 dark:text-gray-100",children:a})}};return e.jsx(Q,{children:e.jsxs("div",{className:"container mx-auto p-4 md:p-6 lg:p-8 space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-center text-gray-800 dark:text-gray-100 mb-8",children:"Gerenciamento de Convites para Personais"}),e.jsxs(L,{className:"max-w-2xl mx-auto shadow-xl border dark:border-gray-700",children:[e.jsxs(A,{children:[e.jsx(S,{className:"text-xl font-semibold text-center",children:"Gerar Novo Convite"}),e.jsx(G,{className:"text-center text-sm text-muted-foreground",children:"Crie um link de convite para novos personais se cadastrarem."})]}),e.jsx(R,{children:e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"emailConvidado",children:"Email do Convidado (Opcional)"}),e.jsx(v,{id:"emailConvidado",name:"emailConvidado",type:"email",placeholder:"exemplo@email.com",value:s.emailConvidado||"",onChange:N,className:"bg-background"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Se preenchido, o convite será específico para este email."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"diasParaExpirar",children:"Validade do Convite (em dias)"}),e.jsx(v,{id:"diasParaExpirar",name:"diasParaExpirar",type:"number",min:"1",placeholder:"7",value:s.diasParaExpirar||"",onChange:N,className:"bg-background"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Padrão: 7 dias. Deixe em branco para usar o padrão do servidor."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"roleConvidado",children:"Tipo de Usuário"}),e.jsxs("select",{id:"roleConvidado",name:"roleConvidado",value:s.roleConvidado||"Personal Trainer",onChange:N,className:"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"Personal Trainer",children:"Personal Trainer"}),e.jsx("option",{value:"Admin",children:"Administrador"})]})]}),e.jsxs(p,{type:"submit",className:"w-full font-semibold",disabled:c,children:[c?e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}):null,c?"Gerando...":"Gerar Convite"]})]})}),h&&e.jsxs(V,{className:"flex flex-col items-center space-y-3 pt-5 border-t dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-center",children:"Link de Convite Gerado:"}),e.jsxs("div",{className:"flex w-full max-w-md items-center space-x-2 p-2 border rounded-md bg-muted dark:bg-gray-800",children:[e.jsx(v,{type:"text",value:h,readOnly:!0,className:"flex-grow bg-transparent border-none focus:ring-0 text-sm"}),e.jsxs(k,{children:[e.jsx(w,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",onClick:I,"aria-label":"Copiar link gerado",children:B?e.jsx(W,{className:"h-5 w-5 text-green-500"}):e.jsx(z,{className:"h-5 w-5"})})}),e.jsx(T,{children:e.jsx("p",{children:"Copiar link"})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Envie este link para o personal."})]})]}),e.jsxs(L,{className:"shadow-xl border dark:border-gray-700",children:[e.jsxs(A,{className:"flex flex-row items-center justify-between pb-4",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-xl font-semibold",children:"Convites Enviados"}),e.jsx(G,{className:"text-sm text-muted-foreground",children:"Lista de todos os convites gerados."})]}),e.jsxs(k,{children:[e.jsx(w,{asChild:!0,children:e.jsx(p,{variant:"outline",size:"icon",onClick:m,disabled:g,"aria-label":"Atualizar lista de convites",children:g?e.jsx(j,{className:"h-4 w-4 animate-spin"}):e.jsx(pe,{className:"h-4 w-4"})})}),e.jsx(T,{children:e.jsx("p",{children:"Atualizar lista"})})]})]}),e.jsxs(R,{children:[g&&x.length===0&&e.jsxs("div",{className:"flex justify-center items-center py-10 text-muted-foreground",children:[e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-3 text-sm",children:"Carregando convites..."})]}),!g&&x.length===0&&e.jsx("p",{className:"text-center text-muted-foreground py-10 text-sm",children:"Nenhum convite encontrado."}),x.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsxs(Y,{className:"mt-4",children:["Um total de ",x.length," convite(s) encontrado(s)."]}),e.jsx(Z,{children:e.jsxs($,{children:[e.jsx(l,{className:"min-w-[200px]",children:"Email Convidado"}),e.jsx(l,{children:"Status"}),e.jsx(l,{className:"min-w-[150px]",children:"Expira Em"}),e.jsx(l,{className:"min-w-[200px]",children:"Utilizado Por"}),e.jsx(l,{className:"min-w-[200px]",children:"Link"}),e.jsx(l,{className:"text-right",children:"Ações"})]})}),e.jsx(ee,{children:x.map(a=>e.jsxs($,{children:[e.jsx(d,{className:"font-medium text-sm",children:a.emailConvidado||e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:"Qualquer email"})}),e.jsx(d,{children:q(a.status)}),e.jsx(d,{className:"text-sm",children:U(a.dataExpiracao)}),e.jsx(d,{className:"text-sm",children:a.usadoPor?`${a.usadoPor.nome||"Nome não disp."} (${a.usadoPor.email||"Email não disp."})`:e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:"Ninguém"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{type:"text",value:`${b}/cadastrar-personal/convite/${a.token}`,readOnly:!0,className:"text-xs p-1 h-8 bg-transparent border-none focus:ring-0 mr-1 truncate flex-grow",title:`${b}/cadastrar-personal/convite/${a.token}`}),e.jsxs(k,{children:[e.jsx(w,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>navigator.clipboard.writeText(`${b}/cadastrar-personal/convite/${a.token}`).then(()=>r({description:"Link do convite copiado!"})),"aria-label":"Copiar link do convite",children:e.jsx(z,{className:"h-4 w-4"})})}),e.jsx(T,{children:e.jsx("p",{children:"Copiar link"})})]})]})}),e.jsx(d,{className:"text-right",children:a.status==="pendente"&&e.jsxs(ae,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(p,{variant:"destructive",size:"sm",onClick:()=>C(a),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Revogar"]})}),e.jsxs(re,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Confirmar Revogação"}),e.jsxs(oe,{children:["Tem certeza que deseja revogar este convite? Esta ação não poderá ser desfeita.",(n==null?void 0:n.emailConvidado)&&` O convite para ${n.emailConvidado} será invalidado.`]})]}),e.jsxs(ne,{children:[e.jsx(le,{onClick:()=>C(null),children:"Cancelar"}),e.jsxs(de,{onClick:O,disabled:c,className:"bg-destructive hover:bg-destructive/90",children:[c?e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Revogar"]})]})]})]})})]},a._id))})]})})]})]})]})})};export{Ne as default};
