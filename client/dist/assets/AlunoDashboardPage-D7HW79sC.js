import{c as R,r as S,j as e,v as $,aa as X,C as N,a as b,b as v,e as w,ab as ee,d as Q,ac as ae,s as se,n as te,D as re,S as E,B as f,H as ie,m as T}from"./index-BzLV8CNE.js";import{P as ne}from"./progress-37Updk6C.js";import{u as I}from"./useQuery-PwrN8lgt.js";import{t as M,c as W,s as O,d as oe,a as le,f as F,i as ce}from"./format-Cj1jUzCS.js";import{C as H}from"./calendar-days-Degg0IRE.js";import{C as de}from"./circle-check-DMXSzY4S.js";import{D as me,a as xe,b as ue,c as he,d as ge,e as fe}from"./dialog-Cc9arakq.js";import{S as k}from"./skeleton-DvEZY-df.js";import{T as pe}from"./triangle-alert-BMd-Rj3a.js";import{E as je}from"./eye-DbA9ViTj.js";import{C as Z}from"./circle-play-CwwuRuoJ.js";import{Z as ye}from"./zap-CMjEOO_s.js";import{p as Ne}from"./parseISO-ChxugJxP.js";import{p as be}from"./pt-BR-C0EKqbj-.js";/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=R("BookOpenCheck",[["path",{d:"M8 3H2v15h7c1.7 0 3 1.3 3 3V7c0-2.2-1.8-4-4-4Z",key:"1i8u0n"}],["path",{d:"m16 12 2 2 4-4",key:"mdajum"}],["path",{d:"M22 6V3h-6c-2.2 0-4 1.8-4 4v14c0-1.7 1.3-3 3-3h7v-2.3",key:"jb5l51"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=R("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=R("Replace",[["path",{d:"M14 4c0-1.1.9-2 2-2",key:"1mvvbw"}],["path",{d:"M20 2c1.1 0 2 .9 2 2",key:"1mj6oe"}],["path",{d:"M22 8c0 1.1-.9 2-2 2",key:"v1wql3"}],["path",{d:"M16 10c-1.1 0-2-.9-2-2",key:"821ux0"}],["path",{d:"m3 7 3 3 3-3",key:"x25e72"}],["path",{d:"M6 10V5c0-1.7 1.3-3 3-3h1",key:"13af7h"}],["rect",{width:"8",height:"8",x:"2",y:"14",rx:"2",key:"17ihk4"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=R("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),De=X("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),_=S.forwardRef(({className:a,variant:s,...t},i)=>e.jsx("div",{ref:i,role:"alert",className:$(De({variant:s}),a),...t}));_.displayName="Alert";const q=S.forwardRef(({className:a,...s},t)=>e.jsx("h5",{ref:t,className:$("mb-1 font-medium leading-none tracking-tight",a),...s}));q.displayName="AlertTitle";const P=S.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:$("text-sm [&_p]:leading-relaxed",a),...s}));P.displayName="AlertDescription";function U(a,s){const t=M(a);return isNaN(s)?W(a,NaN):(s&&t.setDate(t.getDate()+s),t)}function ke(a){return W(a,Date.now())}function Y(a,s){const t=O(a),i=O(s);return+t==+i}function Se(a,s){const t=M(a),i=M(s),m=G(t,i),o=Math.abs(oe(t,i));t.setDate(t.getDate()-m*o);const c=+(G(t,i)===-m),d=m*(o-c);return d===0?0:d}function G(a,s){const t=a.getFullYear()-s.getFullYear()||a.getMonth()-s.getMonth()||a.getDate()-s.getDate()||a.getHours()-s.getHours()||a.getMinutes()-s.getMinutes()||a.getSeconds()-s.getSeconds()||a.getMilliseconds()-s.getMilliseconds();return t<0?-1:t>0?1:t}function Ce(a){return M(a).getDay()}function Ae(a){return Y(a,ke(a))}function Ee(a,s){let t=s-Ce(a);return t<=0&&(t+=7),U(a,t)}const K=["Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],Fe=({sessoesConcluidasNaSemana:a,isLoading:s=!1,error:t=null})=>{const m=le(new Date,{weekStartsOn:1}),o=K.map((d,p)=>U(m,p)),c=d=>a.some(p=>Y(new Date(p.sessionDate),d));return s?e.jsxs(N,{className:"shadow",children:[e.jsx(b,{children:e.jsxs(v,{className:"flex items-center text-lg",children:[e.jsx(H,{className:"w-5 h-5 mr-2 text-primary"}),"Frequência Semanal"]})}),e.jsx(w,{className:"text-center py-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando frequência..."})})]}):t?e.jsxs(N,{className:"shadow border-destructive/50",children:[e.jsx(b,{children:e.jsxs(v,{className:"flex items-center text-lg text-destructive",children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"Frequência Semanal"]})}),e.jsx(w,{className:"text-center py-6",children:e.jsx("p",{className:"text-sm text-destructive",children:"Erro ao carregar frequência."})})]}):e.jsxs(N,{className:"shadow-md",children:[e.jsxs(b,{children:[e.jsxs(v,{className:"flex items-center text-lg",children:[e.jsx(H,{className:"w-5 h-5 mr-2 text-primary"}),"Frequência Semanal"]}),e.jsx(Q,{children:"Seus treinos concluídos nesta semana."})]}),e.jsxs(w,{children:[e.jsx("div",{className:"flex justify-around items-center py-2",children:o.map((d,p)=>{const l=c(d),j=Ae(d),A=K[p];return e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("span",{className:`text-xs font-medium ${j?"text-primary dark:text-sky-400":"text-muted-foreground"}`,children:A}),e.jsx("div",{className:`
                    w-8 h-8 rounded-full flex items-center justify-center border-2
                    ${l?"bg-green-500 border-green-600 dark:bg-green-600 dark:border-green-700":"bg-gray-100 border-gray-300 dark:bg-gray-700 dark:border-gray-600"}
                    ${j&&!l?"border-primary dark:border-sky-500 ring-2 ring-primary/50 dark:ring-sky-500/50":""}
                    ${j&&l?"ring-2 ring-green-500/50 dark:ring-green-600/50":""}
                  `,title:l?`Treino concluído em ${F(d,"dd/MM")}`:`Sem treino concluído em ${F(d,"dd/MM")}`,children:l&&e.jsx(de,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:`text-xs font-bold ${j?"text-primary dark:text-sky-400":"text-foreground"}`,children:F(d,"dd")})]},A)})}),a.length===0&&e.jsx("p",{className:"text-center text-sm text-muted-foreground mt-3",children:"Nenhum treino concluído esta semana ainda. Vamos lá!"})]})]})},Me=({isOpen:a,onClose:s,onStart:t,diaDeTreino:i})=>{if(!i)return null;const m=i.exerciciosDoDia.filter(o=>o.exercicioId&&typeof o.exercicioId=="object").sort((o,c)=>o.ordemNoDia-c.ordemNoDia);return e.jsx(me,{open:a,onOpenChange:s,children:e.jsxs(xe,{className:"sm:max-w-md",children:[e.jsxs(ue,{children:[e.jsxs(he,{children:[i.identificadorDia,i.nomeSubFicha&&` - ${i.nomeSubFicha}`]}),e.jsx(ge,{children:"Lista de exercícios para este dia."})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-4 my-4",children:e.jsx("ul",{className:"space-y-3",children:m.map(o=>e.jsx("li",{className:"text-sm p-2 bg-slate-50 rounded-md",children:o.exercicioId.nome},o._id))})}),e.jsxs(fe,{className:"flex-col-reverse sm:flex-row sm:justify-between gap-2",children:[e.jsx(f,{type:"button",variant:"secondary",onClick:s,children:"Fechar"}),e.jsxs(f,{type:"button",onClick:t,children:[e.jsx(Z,{className:"mr-2 h-4 w-4"})," Iniciar Treino"]})]})]})})},Re={domingo:0,"segunda-feira":1,"terca-feira":2,"quarta-feira":3,"quinta-feira":4,"sexta-feira":5,sabado:6},Te=a=>{const s=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace("-feira",""),t=Re[s];return t===void 0?null:Ee(new Date,t)},We=()=>{var L;const{aluno:a}=ae(),[,s]=se(),[t,i]=S.useState(()=>a?localStorage.getItem(`activeRotinaId_${a.id}`):null),[m,o]=S.useState(null),{data:c,isLoading:d,error:p}=I({queryKey:["minhasRotinasAluno",a==null?void 0:a.id],queryFn:async()=>{if(!(a!=null&&a.id))throw new Error("Aluno não autenticado.");return(await T("GET","/api/aluno/meus-treinos",void 0,"aluno")).sort((x,h)=>new Date(h.atualizadoEm||h.criadoEm).getTime()-new Date(x.atualizadoEm||x.criadoEm).getTime())},enabled:!!a,staleTime:1e3*60*5}),{data:l,isLoading:j}=I({queryKey:["statsProgressoAluno",a==null?void 0:a.id],queryFn:()=>T("GET","/api/aluno/stats-progresso",void 0,"aluno"),enabled:!!a,staleTime:1e3*60*5});S.useEffect(()=>{if(!a)return;(()=>{if(c&&c.length>0){const h=localStorage.getItem(`activeRotinaId_${a.id}`),g=c.some(u=>u._id===h);if(!h||!g){const u=c[0]._id;localStorage.setItem(`activeRotinaId_${a.id}`,u),i(u)}else i(h)}})();const x=h=>{h.key===`activeRotinaId_${a.id}`&&i(h.newValue)};return window.addEventListener("storage",x),()=>{window.removeEventListener("storage",x)}},[c,a]);const{data:A,isLoading:V}=I({queryKey:["frequenciaSemanalAluno",a==null?void 0:a.id],queryFn:async()=>{if(!(a!=null&&a.id))throw new Error("Aluno não autenticado.");return T("GET","/api/aluno/minhas-sessoes-concluidas-na-semana",void 0,"aluno")},enabled:!!a,staleTime:1e3*60*1}),r=c&&t&&(c.find(C=>C._id===t)||c[0])||null,J=()=>{if(!r||!r.diasDeTreino||r.diasDeTreino.length===0)return{proximoDiaSugerido:null,alertaRotina:{tipo:"warning",mensagem:"Sua rotina ativa está vazia. Fale com seu personal ou escolha outra rotina."}};const C=[...r.diasDeTreino].map(g=>{let u;if(r.tipoOrganizacaoRotina==="diasDaSemana"&&g.identificadorDia){const D=Te(g.identificadorDia);D&&(u=F(D,"EEEE, dd/MM",{locale:be}))}return{...g,dataSugeridaFormatada:u}}).sort((g,u)=>g.ordemNaRotina-u.ordemNaRotina);let x=null;if(r.dataValidade){const g=Ne(r.dataValidade),u=new Date;if(ce(g)){const D=Se(g,u);D<0?x={tipo:"warning",mensagem:"Esta rotina expirou! Fale com seu personal para obter uma nova."}:D<=7&&(x={tipo:"warning",mensagem:`Atenção: Sua rotina expira em ${D+1} dia(s)!`})}}return!x&&r.totalSessoesRotinaPlanejadas&&r.sessoesRotinaConcluidas>=r.totalSessoesRotinaPlanejadas&&(x={tipo:"info",mensagem:"Parabéns, você concluiu esta rotina! Fale com seu personal para os próximos passos."}),{proximoDiaSugerido:C[0]||null,alertaRotina:x}},{proximoDiaSugerido:y,alertaRotina:n}=J();return d||V||!a||j?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-indigo-600 to-blue-400",children:[e.jsx(te,{className:"h-10 w-10 animate-spin text-white"}),e.jsx("span",{className:"ml-4 text-lg text-white",children:"Carregando seu painel..."})]}):p?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-600 to-blue-400 p-4 text-white",children:e.jsxs(_,{variant:"destructive",className:"bg-red-800/80 border-red-500 text-white",children:[e.jsx(q,{children:"Erro de Conexão"}),e.jsx(P,{children:"Não foi possível carregar suas rotinas de treino. Por favor, tente novamente mais tarde."})]})}):e.jsxs("div",{className:"min-h-screen text-white",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Olá, ",((L=a.nome)==null?void 0:L.split(" ")[0])||"Aluno","!"]}),e.jsx("p",{className:"text-lg mt-1 opacity-90",children:"Pronto para o seu próximo desafio?"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{className:"bg-white/95 backdrop-blur-sm text-gray-800 rounded-2xl shadow-lg border-0",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-6 h-6 text-indigo-600"}),e.jsx(v,{className:"text-xl font-bold",children:"Seu Treino de Hoje"})]}),e.jsxs(Q,{className:"!mt-2",children:["Sua rotina ativa é: ",e.jsx("span",{className:"font-semibold text-indigo-600",children:(r==null?void 0:r.titulo)||"Nenhuma"})]})]}),e.jsxs(w,{className:"space-y-4",children:[n&&e.jsxs(_,{variant:n.tipo==="warning"?"destructive":"default",className:n.tipo==="info"?"bg-blue-50 border-blue-200":"",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx(q,{children:n.tipo==="warning"?"Atenção!":"Aviso"}),e.jsx(P,{children:n.mensagem})]}),r&&y&&!(n!=null&&n.mensagem.includes("expirou"))&&!(n!=null&&n.mensagem.includes("concluiu"))?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Próximo treino sugerido:"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[y.identificadorDia,y.nomeSubFicha?` - ${y.nomeSubFicha}`:""]})]}),r.totalSessoesRotinaPlanejadas!=null&&r.totalSessoesRotinaPlanejadas>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium mb-1 text-gray-700",children:["Progresso da Rotina (",r.sessoesRotinaConcluidas," de ",r.totalSessoesRotinaPlanejadas,")"]}),e.jsx(ne,{value:r.sessoesRotinaConcluidas/r.totalSessoesRotinaPlanejadas*100,className:"h-2.5"})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-600",children:r?"Fale com seu personal ou ative outra rotina.":"Você não possui uma rotina ativa."})})]}),e.jsx(E,{className:"flex-col items-stretch gap-3 pt-4",children:r&&y&&!(n!=null&&n.mensagem.includes("expirou"))&&!(n!=null&&n.mensagem.includes("concluiu"))?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(f,{variant:"outline",className:"w-full sm:w-auto",onClick:()=>o(y),children:[e.jsx(je,{className:"w-4 h-4 mr-2"})," Ver Detalhes"]}),e.jsxs(f,{size:"lg",className:"w-full sm:flex-1 font-bold text-base bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-md",onClick:()=>s(`/aluno/ficha/${r._id}?diaId=${y._id}`),children:[e.jsx(Z,{className:"w-5 h-5 mr-2"})," Iniciar Treino"]})]}),e.jsxs(f,{variant:"link",className:"text-sm text-gray-600 hover:text-indigo-600 h-auto",onClick:()=>s(`/aluno/ficha/${r._id}`),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Escolher outro treino"]})]}):e.jsxs(f,{size:"lg",className:"w-full font-bold text-base bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-md",onClick:()=>s("/aluno/meus-treinos"),children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"Ativar uma Rotina"]})})]}),e.jsxs(N,{className:"bg-white/95 backdrop-blur-sm text-gray-800 rounded-2xl shadow-lg border-0",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-6 h-6 text-yellow-500"}),e.jsx(v,{className:"text-xl font-bold",children:"Sua Frequência Semanal"})]})}),e.jsx(w,{children:e.jsx(Fe,{sessoesConcluidasNaSemana:A||[],isLoading:V})}),e.jsx(E,{children:e.jsxs(f,{variant:"outline",className:"w-full border-gray-300 text-gray-700 hover:bg-gray-100 hover:text-gray-900",onClick:()=>s("/aluno/historico"),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Ver Histórico Completo"]})})]}),e.jsxs(N,{className:"bg-white/95 backdrop-blur-sm text-gray-800 rounded-2xl shadow-lg border-0",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-6 h-6 text-green-500"}),e.jsx(v,{className:"text-xl font-bold",children:"Seu Progresso"})]})}),e.jsx(w,{className:"space-y-2 text-sm",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center p-3",children:[e.jsx(k,{className:"h-5 w-40"}),e.jsx(k,{className:"h-6 w-10"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[e.jsx(k,{className:"h-5 w-24"}),e.jsx(k,{className:"h-6 w-10"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[e.jsx(k,{className:"h-5 w-32"}),e.jsx(k,{className:"h-6 w-10"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-600",children:"Total de Treinos Concluídos"}),e.jsx("span",{className:"font-bold text-lg text-gray-800",children:(l==null?void 0:l.totalTreinosConcluidos)??0})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-600",children:"Média de PSE"}),e.jsx("span",{className:"font-bold text-lg text-gray-800",children:(l==null?void 0:l.mediaPSE)??"N/D"})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-600",children:"Dias Consecutivos"}),e.jsx("span",{className:"font-bold text-lg text-gray-800",children:(l==null?void 0:l.diasConsecutivos)??0})]})]})}),e.jsx(E,{children:e.jsxs(f,{variant:"outline",className:"w-full border-gray-300 text-gray-700",disabled:!0,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Análise de Progresso (Em breve)"]})})]}),e.jsxs(N,{className:"bg-white/95 backdrop-blur-sm text-gray-800 rounded-2xl shadow-lg border-0",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"w-6 h-6 text-blue-500"}),e.jsx(v,{className:"text-xl font-bold",children:"Suas Fichas de Treino"})]})}),e.jsx(w,{children:e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Gerencie todas as suas rotinas e escolha qual seguir."})}),e.jsx(E,{children:e.jsxs(f,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl",onClick:()=>s("/aluno/meus-treinos"),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Ver Todas as Rotinas"]})})]})]}),e.jsx(Me,{isOpen:!!m,onClose:()=>o(null),onStart:()=>{m&&r&&(s(`/aluno/ficha/${r._id}?diaId=${m._id}`),o(null))},diaDeTreino:m})]})};export{We as default};
