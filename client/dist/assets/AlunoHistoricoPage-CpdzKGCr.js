import{c as H,o as z,r as g,j as e,D as _,n as I,B as l,m as k,ac as B,L as R,C,a as M,b as S,H as O,d as P,e as A,S as U,af as G}from"./index-BzLV8CNE.js";import{u as E}from"./useQuery-PwrN8lgt.js";import{B as V}from"./badge-mwLuO-R-.js";import{D as K,a as Q,b as J,c as W,d as X,e as Y}from"./dialog-Cc9arakq.js";import{V as Z}from"./VideoPlayerModal-DmKj2Fh1.js";import{C as ee}from"./calendar-B7v250f8.js";import{S as T}from"./star-Db543mjc.js";import{C as te}from"./circle-play-CwwuRuoJ.js";import{f as F}from"./format-Cj1jUzCS.js";import{p as L}from"./parseISO-ChxugJxP.js";import{p as q}from"./pt-BR-C0EKqbj-.js";import{T as ae}from"./triangle-alert-BMd-Rj3a.js";import{A as re}from"./arrow-left-CY9mcJgZ.js";import{E as ie}from"./eye-DbA9ViTj.js";import{C as se}from"./chevron-left-B1YWD8N6.js";/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=H("MessageSquareText",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=H("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),le=t=>{if(!t)return"secondary";switch(t){case"Muito Leve":case"Leve":return"default";case"Moderado":return"secondary";case"Intenso":case"Muito Intenso":return"outline";case"Máximo Esforço":return"destructive";default:return"secondary"}};function oe({sessao:t,onClose:n}){var N,y,v,b;const o=!!t,{toast:x}=z(),[j,c]=g.useState(null),{data:i,isLoading:f,error:u,isSuccess:h}=E({queryKey:["detalhesRotinaHistorico",(N=t==null?void 0:t.rotinaId)==null?void 0:N._id],queryFn:()=>k("GET",`/api/aluno/meus-treinos/${t.rotinaId._id}`,void 0,"aluno"),enabled:o&&!!((y=t==null?void 0:t.rotinaId)!=null&&y._id)}),p=((v=i==null?void 0:i.diasDeTreino.find(r=>r._id===(t==null?void 0:t.diaDeTreinoId)))==null?void 0:v.exerciciosDoDia.sort((r,s)=>r.ordemNoDia-s.ordemNoDia))||[],a=t?F(L(t.concluidaEm),"dd 'de' MMMM 'de' yyyy, 'às' HH:mm",{locale:q}):"",d=r=>{var w,D;if(!r){x({title:"Vídeo não disponível"});return}let s=r;if(r.includes("youtube.com/watch?v="))s=r.replace("watch?v=","embed/");else if(r.includes("youtu.be/")){const m=(w=r.split("youtu.be/")[1])==null?void 0:w.split("?")[0];m&&(s=`https://www.youtube.com/embed/${m}`)}else if(r.includes("drive.google.com/file/d/")){const m=(D=r.split("/d/")[1])==null?void 0:D.split("/")[0];m&&(s=`https://drive.google.com/file/d/${m}/preview`)}c(s)};return e.jsxs(e.Fragment,{children:[e.jsx(K,{open:o,onOpenChange:r=>!r&&n(),children:e.jsxs(Q,{className:"sm:max-w-[550px] max-h-[90vh] flex flex-col",children:[e.jsxs(J,{children:[e.jsx(W,{className:"text-xl text-primary",children:((b=t==null?void 0:t.rotinaId)==null?void 0:b.titulo)||"Detalhes do Treino"}),e.jsxs(X,{children:[t==null?void 0:t.diaDeTreinoIdentificador,(t==null?void 0:t.nomeSubFichaDia)&&` - ${t.nomeSubFichaDia}`]})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto pr-4 -mr-4 space-y-4",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-muted-foreground"})," ",e.jsx("span",{className:"text-sm font-medium",children:a})]}),(t==null?void 0:t.pseAluno)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"font-semibold text-sm",children:"Seu PSE:"}),e.jsx(V,{variant:le(t.pseAluno),children:t.pseAluno})]}),(t==null?void 0:t.comentarioAluno)&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-500 mt-1 shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Seu comentário:"}),e.jsx("blockquote",{className:"mt-1 text-xs italic text-muted-foreground border-l-2 pl-3",children:t.comentarioAluno})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-md font-semibold mb-3 flex items-center",children:[e.jsx(_,{className:"w-5 h-5 mr-2"})," Exercícios Realizados"]}),f&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(I,{className:"w-6 h-6 animate-spin text-primary"})}),u&&e.jsx("p",{className:"text-sm text-red-500",children:"Não foi possível carregar os exercícios."}),h&&e.jsx("div",{className:"space-y-2",children:p.length>0?p.map(r=>{const s=r.exercicioId&&typeof r.exercicioId=="object"?r.exercicioId:null;return e.jsxs("div",{className:"text-sm p-3 border rounded-md flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(s==null?void 0:s.nome)||"Exercício não encontrado"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.series&&`${r.series}x`,r.repeticoes,r.carga&&` - ${r.carga}`]})]}),s!=null&&s.urlVideo?e.jsx(l,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>d(s.urlVideo),children:e.jsx(te,{className:"w-5 h-5 text-red-500"})}):e.jsx("span",{title:"Vídeo não disponível",children:e.jsx(ne,{className:"w-5 h-5 text-muted-foreground"})})]},r._id)}):e.jsx("p",{className:"text-xs text-center text-muted-foreground py-2",children:"Nenhum exercício detalhado encontrado para este dia."})})]})]}),e.jsx(Y,{children:e.jsx(l,{type:"button",variant:"outline",onClick:n,children:"Fechar"})})]})}),e.jsx(Z,{videoUrl:j,onClose:()=>c(null)})]})}const ce=t=>{if(!t)return"secondary";switch(t){case"Muito Leve":case"Leve":return"default";case"Moderado":return"secondary";case"Intenso":case"Muito Intenso":return"outline";case"Máximo Esforço":return"destructive";default:return"secondary"}},Ce=()=>{const{aluno:t}=B(),[n,o]=g.useState(1),x=5,[j,c]=g.useState(null),{data:i,isLoading:f,error:u,isFetching:h}=E({queryKey:["alunoHistoricoSessoes",t==null?void 0:t.id,n,x],queryFn:async()=>{if(!(t!=null&&t.id))throw new Error("Aluno não autenticado.");return k("GET",`/api/aluno/meu-historico-sessoes?page=${n}&limit=${x}`,void 0,"aluno")},enabled:!!t,placeholderData:a=>a});if(f&&!i)return e.jsxs("div",{className:"min-h-screen w-full flex items-center justify-center",children:[" ",e.jsxs("div",{className:"flex flex-col items-center",children:[" ",e.jsx(I,{className:"h-10 w-10 animate-spin text-white mb-3"})," ",e.jsx("p",{className:"text-lg text-white",children:"Carregando seu histórico..."})," "]})," "]});if(u)return e.jsxs("div",{className:"p-4",children:[" ",e.jsxs("div",{className:"bg-red-800/80 border border-red-500 text-white p-4 rounded-lg flex items-center",children:[" ",e.jsx(ae,{className:"w-5 h-5 mr-3"})," ",e.jsxs("span",{children:["Erro: ",u.message]})," "]})," "]});const p=a=>{if(!a)return"N/A";try{return F(L(a),"dd/MM/yy 'às' HH:mm",{locale:q})}catch{return"Data inválida"}};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx(R,{href:"/aluno/dashboard",children:e.jsxs(l,{variant:"outline",size:"sm",className:"bg-white/20 hover:bg-white/30 border-white/50 text-white rounded-lg",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Voltar ao Painel"]})})}),e.jsxs(C,{className:"bg-slate-50 text-gray-800 rounded-2xl shadow-lg border-0",children:[e.jsxs(M,{children:[e.jsxs(S,{className:"text-2xl sm:text-3xl font-bold text-indigo-700 flex items-center gap-3",children:[e.jsx(O,{className:"w-8 h-8"}),"Meu Histórico de Treinos"]}),e.jsx(P,{children:"Revise seus treinos concluídos e seu feedback."})]}),e.jsxs(A,{children:[!i||i.sessoes.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600",children:"Você ainda não concluiu nenhum treino."}),e.jsx("p",{className:"text-sm mt-2 text-gray-500",children:"Comece um treino no seu painel para ver seu progresso aqui!"})]}):e.jsx("div",{className:"space-y-5",children:i.sessoes.map(a=>{var d;return e.jsxs(C,{className:"bg-card border border-slate-200 shadow-sm rounded-xl",children:[e.jsxs(M,{className:"flex flex-row justify-between items-start pb-3",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-lg leading-tight text-gray-900",children:((d=a.rotinaId)==null?void 0:d.titulo)||"Sessão Avulsa"}),e.jsxs(P,{className:"text-sm mt-1",children:[a.diaDeTreinoIdentificador||"Detalhes não especificados",a.nomeSubFichaDia&&` - ${a.nomeSubFichaDia}`]})]}),a.rotinaId&&a.diaDeTreinoId&&e.jsxs(l,{variant:"ghost",size:"sm",className:"text-xs h-8 text-indigo-600 hover:text-indigo-700",onClick:()=>c(a),children:["Ver Detalhes ",e.jsx(ie,{className:"w-3 h-3 ml-1.5"})]})]}),e.jsxs(A,{className:"space-y-3",children:[a.pseAluno&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"font-semibold text-sm text-gray-800",children:"PSE:"}),e.jsx(V,{variant:ce(a.pseAluno),children:a.pseAluno})]}),a.comentarioAluno&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-500 mt-1 shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Seu comentário:"}),e.jsx("blockquote",{className:"mt-1 text-xs italic text-gray-600 border-l-2 pl-3",children:a.comentarioAluno})]})]})]}),e.jsx(U,{className:"text-xs text-gray-500 pt-3 pb-4 border-t",children:e.jsxs("p",{children:["Finalizado em: ",p(a.concluidaEm)]})})]},a._id)})}),i&&i.totalPages>1&&e.jsxs("div",{className:"pt-6 flex items-center justify-between border-t mt-6",children:[e.jsxs(l,{variant:"outline",className:"border-gray-300 text-gray-700",size:"sm",onClick:()=>o(a=>Math.max(1,a-1)),disabled:n===1||h,children:[e.jsx(se,{className:"w-4 h-4 mr-1"})," Anterior"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Página ",i.currentPage," de ",i.totalPages]}),e.jsxs(l,{variant:"outline",className:"border-gray-300 text-gray-700",size:"sm",onClick:()=>o(a=>Math.min(i.totalPages,a+1)),disabled:n===i.totalPages||h,children:["Próxima ",e.jsx(G,{className:"w-4 h-4 ml-1"})]})]})]})]}),e.jsx(oe,{sessao:j,onClose:()=>c(null)})]})};export{Ce as default};
