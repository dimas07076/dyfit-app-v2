import{c as Ze,r,o as z,q as ye,j as e,Q as We,n as _,B as j,m as N,C as Xe,a as Ye,b as es,d as ss,e as as,U as ts,S as os,G as ie,J as ne,K as le,N as de,I as Ne,u as rs,D as is}from"./index-BzLV8CNE.js";import{u as F}from"./useQuery-PwrN8lgt.js";import{u as D}from"./useMutation-CMAM4n7S.js";import{F as Ce,c as ns,B as ls,A as ds,d as cs,e as ms,f as us,S as xs,a as hs,R as ps}from"./RotinaFormModal-Ov1nMD2j.js";import{L as gs}from"./LoadingSpinner-CMtr6_ld.js";import{E as js}from"./ErrorMessage-CKvNOnls.js";import{A as ce,b as me,c as ue,d as xe,e as he,f as pe,g as ge,h as je}from"./alert-dialog-Cli0ldNh.js";import{D as be,a as Pe,b as we,c as Se,d as Ae,e as Me}from"./dialog-Cc9arakq.js";import{S as fs,a as vs,b as ys,c as Ns,d as Cs}from"./select-WeAdnBMh.js";import{B as Q}from"./badge-mwLuO-R-.js";import{P as bs,a as Ps,b as ws}from"./popover-CWE9MTME.js";import{E as Ss}from"./eye-DbA9ViTj.js";import{S as Te}from"./square-pen-DXG1TAJA.js";import{T as ke}from"./trash-2-CwwKKaCS.js";import{P as As,T as Ms,a as Ts,b as fe,c as ve}from"./tabs-Dt_cpVbU.js";import{L as ks}from"./label-ErXilaHi.js";import{V as Es}from"./VideoPlayerModal-DmKj2Fh1.js";import"./table-C_2_dIR3.js";import"./info-CBDjHlMF.js";import"./clock-Ds75S8Ae.js";import"./circle-play-CwwuRuoJ.js";import"./textarea-Bgva5FCm.js";import"./triangle-alert-BMd-Rj3a.js";import"./arrow-left-CY9mcJgZ.js";/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=Ze("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Fs=({isOpen:t,onClose:u,fichaModeloId:x,fichaModeloTitulo:l})=>{const[d,h]=r.useState(""),[p,c]=r.useState(!1),{toast:m}=z(),f=ye(),{data:o=[],isLoading:C}=F({queryKey:["/api/aluno/gerenciar"],queryFn:async()=>{console.log("[AssociarModeloAlunoModal] Buscando alunos para o modal...");const i=await N("GET","/api/aluno/gerenciar");return console.log(`[AssociarModeloAlunoModal] ${i.length} alunos recebidos.`),Array.isArray(i)?i:[]},enabled:t,staleTime:1e3*60*5});r.useEffect(()=>{t&&h("")},[t,x]);const b=async()=>{if(!x||!d){m({variant:"destructive",title:"Seleção Incompleta",description:"Por favor, selecione um aluno."});return}c(!0);const i={fichaModeloId:x,alunoId:d},v="/api/treinos/associar-modelo";try{const g=await N("POST",v,i);m({title:"Sucesso!",description:`Ficha "${g.titulo}" criada para ${g.alunoId.nome}.`}),f.invalidateQueries({queryKey:["/api/treinos"]}),f.invalidateQueries({queryKey:["alunoRotinas",d]}),u()}catch(g){m({variant:"destructive",title:"Erro ao Associar",description:g.message||"Não foi possível criar a ficha individual a partir do modelo."})}finally{c(!1)}};return!t||!x||!l?null:e.jsx(be,{open:t,onOpenChange:i=>!i&&u(),children:e.jsxs(Pe,{className:"sm:max-w-md",children:[e.jsxs(we,{children:[e.jsxs(Se,{className:"flex items-center",children:[e.jsx(We,{className:"w-5 h-5 mr-2 text-primary"}),"Associar Modelo: ",l]}),e.jsx(Ae,{children:"Selecione um aluno para criar uma ficha individual baseada neste modelo."})]}),e.jsx("div",{className:"py-4 space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aluno-select-associar",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Selecionar Aluno*"}),C?e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx(_,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Carregando alunos..."})]}):o.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum aluno cadastrado para selecionar."}):e.jsxs(fs,{value:d,onValueChange:h,disabled:p,children:[e.jsx(vs,{id:"aluno-select-associar",className:"w-full",children:e.jsx(ys,{placeholder:"Escolha um aluno..."})}),e.jsx(Ns,{children:o.map(i=>e.jsxs(Cs,{value:i._id,children:[i.nome," (",i.email,")"]},i._id))})]})]})}),e.jsxs(Me,{children:[e.jsx(j,{variant:"outline",onClick:u,disabled:p,children:"Cancelar"}),e.jsxs(j,{onClick:b,disabled:p||C||!d||o.length===0,children:[p&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Associar e Criar Ficha"]})]})]})})},K=({rotina:t,pastas:u,alunoNome:x,onView:l,onEdit:d,onDelete:h,onAssign:p,onMoveToFolder:c,onRemoveFromFolder:m,onConvertToModel:f})=>{var g;const o=t.tipo==="modelo",C=Array.isArray(t.diasDeTreino)?t.diasDeTreino.length:0,b=typeof t.pastaId=="object"?(g=t.pastaId)==null?void 0:g._id:t.pastaId,i=u.filter(y=>y._id!==b),v=({title:y,onClick:M,children:R,className:P})=>e.jsx(ie,{delayDuration:200,children:e.jsxs(ne,{children:[e.jsx(le,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:`h-8 w-8 ${P}`,onClick:M,children:R})}),e.jsx(de,{children:e.jsx("p",{children:y})})]})});return e.jsxs(Xe,{className:"flex flex-col h-full shadow-md hover:shadow-lg transition-shadow duration-200 dark:bg-slate-800",children:[e.jsxs(Ye,{className:"pb-2",children:[e.jsx(es,{className:"text-base font-bold truncate text-slate-800 dark:text-slate-100",title:t.titulo,children:t.titulo}),e.jsx(ss,{className:"text-xs text-slate-500 dark:text-slate-400 h-8 line-clamp-2",title:t.descricao??void 0,children:t.descricao||"Sem descrição."})]}),e.jsxs(as,{className:"flex-grow pt-2 pb-4 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(Q,{variant:"secondary",children:`${C} Dia(s)`}),e.jsx(Q,{variant:o?"outline":"default",className:o?"border-primary text-primary":"bg-teal-100 text-teal-800 border-transparent hover:bg-teal-100/80 dark:bg-teal-900/50 dark:text-teal-300",children:o?"Modelo":"Individual"})]}),!o&&x&&e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground pt-1",children:[e.jsx(ts,{className:"h-4 w-4 mr-2 shrink-0"}),e.jsx("span",{className:"truncate",title:x,children:x})]})]}),e.jsxs(os,{className:"p-2 border-t dark:border-slate-700 flex justify-between items-center gap-1 mt-auto",children:[e.jsx("div",{className:"flex-1",children:o&&e.jsxs(bs,{children:[e.jsx(ie,{delayDuration:200,children:e.jsxs(ne,{children:[e.jsx(le,{asChild:!0,children:e.jsx(Ps,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Ce,{className:"h-4 w-4 text-slate-500"})})})}),e.jsx(de,{children:e.jsx("p",{children:"Mover para Pasta"})})]})}),e.jsx(ws,{className:"w-56 p-2",children:e.jsxs("div",{className:"grid gap-1",children:[e.jsx("p",{className:"font-semibold text-sm px-2 py-1.5 text-muted-foreground",children:"Mover para..."}),i.length>0?i.map(y=>e.jsx(j,{variant:"ghost",className:"w-full justify-start text-sm",onClick:()=>c(t._id,y._id),children:y.nome},y._id)):e.jsx("p",{className:"text-xs text-muted-foreground px-2 py-1.5",children:"Nenhuma outra pasta disponível."}),b&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-1"}),e.jsx(j,{variant:"ghost",className:"w-full justify-start text-sm text-red-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/50",onClick:()=>m(t._id),children:"Remover da Pasta Atual"})]})]})})]})}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx(v,{title:"Visualizar",onClick:()=>l(t),children:e.jsx(Ss,{className:"h-4 w-4 text-slate-500"})}),o&&e.jsx(v,{title:"Atribuir a Aluno",onClick:()=>p(t._id,t.titulo),children:e.jsx(ns,{className:"h-4 w-4 text-slate-500"})}),!o&&e.jsxs(v,{title:"Tornar Modelo",onClick:()=>f(t),className:"text-primary/80 hover:text-primary",children:[e.jsx(ls,{className:"h-4 w-4"})," "]}),e.jsx(v,{title:"Editar",onClick:()=>d(t),children:e.jsx(Te,{className:"h-4 w-4 text-slate-500"})}),e.jsx(v,{title:"Excluir",onClick:()=>h(t),className:"text-red-500/80 hover:text-red-500",children:e.jsx(ke,{className:"h-4 w-4"})})]})]})]})},Ds=({isOpen:t,onClose:u,onSuccessCallback:x,initialData:l})=>{const[d,h]=r.useState(""),{toast:p}=z(),c=!!l;r.useEffect(()=>{t&&h(c?l.nome:"")},[t,c,l]);const m=D({mutationFn:o=>{const C=c?`/api/pastas/treinos/${l==null?void 0:l._id}`:"/api/pastas/treinos";return N(c?"PUT":"POST",C,o)},onSuccess:()=>{p({title:"Sucesso!",description:`Pasta ${c?"atualizada":"criada"} com sucesso.`}),x()},onError:o=>{p({variant:"destructive",title:"Erro",description:o.message}),u()}}),f=()=>{if(!d.trim()){p({variant:"destructive",title:"Erro de Validação",description:"O nome da pasta é obrigatório."});return}m.mutate({nome:d.trim()})};return t?e.jsx(be,{open:t,onOpenChange:u,children:e.jsxs(Pe,{className:"sm:max-w-md",children:[e.jsxs(we,{children:[e.jsx(Se,{children:c?"Editar Pasta":"Nova Pasta"}),e.jsx(Ae,{children:"Organize suas rotinas modelo."})]}),e.jsxs("div",{className:"py-4 space-y-2",children:[e.jsx(ks,{htmlFor:"nome-pasta",children:"Nome da Pasta*"}),e.jsx(Ne,{id:"nome-pasta",value:d,onChange:o=>h(o.target.value),placeholder:"Ex: Adaptação, Hipertrofia, Cutting...",disabled:m.isPending})]}),e.jsxs(Me,{children:[e.jsx(j,{variant:"outline",onClick:u,disabled:m.isPending,children:"Cancelar"}),e.jsxs(j,{onClick:f,disabled:m.isPending||!d.trim(),children:[m.isPending&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Salvar":"Criar"]})]})]})}):null};function ra(){const[t,u]=r.useState(!1),[x,l]=r.useState(null),[d,h]=r.useState(!1),[p,c]=r.useState(null),[m,f]=r.useState(!1),[o,C]=r.useState(null),[b,i]=r.useState("modelos"),[v,g]=r.useState(!1),[y,M]=r.useState(null),[R,P]=r.useState(!1),[T,U]=r.useState(null),[Ee,G]=r.useState(null),[E,Ie]=r.useState(""),[Fe,q]=r.useState(!1),[k,De]=r.useState(null),w=ye(),{toast:S}=z(),{user:O}=rs(),H=O==null?void 0:O.id,{data:L=[],isLoading:_e,error:J}=F({queryKey:["/api/treinos"],queryFn:()=>N("GET","/api/treinos")}),{data:I=[],isLoading:Re}=F({queryKey:["/api/aluno/gerenciar"],queryFn:()=>N("GET","/api/aluno/gerenciar"),staleTime:1e3*60*5}),{data:V=[],isLoading:qe}=F({queryKey:["/api/pastas/treinos"],queryFn:()=>N("GET","/api/pastas/treinos")}),Z=D({mutationFn:({id:s,tipo:a})=>N("DELETE",a==="rotina"?`/api/treinos/${s}`:`/api/pastas/treinos/${s}`),onSuccess:(s,a)=>{const n=a.tipo==="rotina"?"Rotina":"Pasta";S({title:"Sucesso!",description:`${n} excluída com sucesso.`}),w.invalidateQueries({queryKey:["/api/treinos"]}),w.invalidateQueries({queryKey:["/api/pastas/treinos"]}),H&&w.invalidateQueries({queryKey:["dashboardGeral",H]})},onError:s=>S({variant:"destructive",title:"Erro ao Excluir",description:s.message}),onSettled:()=>P(!1)}),W=D({mutationFn:({rotinaId:s,pastaId:a})=>N("PUT",`/api/treinos/${s}/pasta`,{pastaId:a}),onSuccess:s=>{S({title:"Sucesso!",description:`Rotina "${s.titulo}" movida.`}),w.setQueryData(["/api/treinos"],a=>a?a.map(n=>n._id===s._id?s:n):[s])},onError:s=>S({variant:"destructive",title:"Erro ao Mover",description:s.message})}),$=D({mutationFn:s=>N("POST",`/api/treinos/copiar-para-modelo/${s}`),onSuccess:s=>{S({title:"Sucesso!",description:`Rotina "${s.titulo}" criada como modelo.`}),w.invalidateQueries({queryKey:["/api/treinos"]})},onError:s=>S({variant:"destructive",title:"Erro ao Converter",description:s.message}),onSettled:()=>q(!1)}),Oe=()=>{l(null),u(!0)},X=s=>{h(!1),l(s),u(!0)},Le=s=>{c(s),h(!0)},Y=(s,a)=>{h(!1),C({id:s,titulo:a}),f(!0)},ee=s=>{M(s||null),g(!0)},Ve=s=>{U({id:s._id,nome:s.titulo,tipo:"rotina"}),P(!0)},$e=s=>{U({id:s._id,nome:s.nome,tipo:"pasta"}),P(!0)},Be=()=>{T&&Z.mutate(T)},Ke=(s,a)=>W.mutate({rotinaId:s,pastaId:a}),Qe=s=>W.mutate({rotinaId:s,pastaId:null}),ze=()=>{w.invalidateQueries({queryKey:["/api/pastas/treinos"]}),g(!1),M(null)},Ue=s=>G(s),se=s=>{De(s),q(!0)},Ge=()=>{k&&$.mutate(k._id)},ae=r.useMemo(()=>{const s=L.filter(n=>n.tipo==="individual");if(!E.trim())return s;const a=E.toLowerCase();return s.filter(n=>{const A=I.find(Je=>{var re;return Je._id===(typeof n.alunoId=="string"?n.alunoId:(re=n.alunoId)==null?void 0:re._id)});return(A==null?void 0:A.nome.toLowerCase().includes(a))||n.titulo.toLowerCase().includes(a)})},[L,I,E]);if(_e||qe||Re)return e.jsx(gs,{text:"Carregando dados..."});if(J)return e.jsx(js,{title:"Erro ao Carregar Dados",message:J.message});const te=L.filter(s=>s.tipo==="modelo"),He=V.sort((s,a)=>(s.ordem||0)-(a.ordem||0)).map(s=>({...s,rotinas:te.filter(a=>{var n;return(typeof a.pastaId=="string"?a.pastaId:(n=a.pastaId)==null?void 0:n._id)===s._id})})),oe=te.filter(s=>!s.pastaId),B={onView:Le,onEdit:X,onDelete:Ve,onAssign:Y,onMoveToFolder:Ke,onRemoveFromFolder:Qe,onConvertToModel:se};return e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:justify-between md:items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center",children:[e.jsx(is,{className:"mr-3 h-8 w-8 text-primary"}),"Gerenciar Rotinas"]}),e.jsxs("div",{className:"flex w-full md:w-auto gap-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>ee(),className:"flex-1 md:flex-none",children:[e.jsx(Is,{className:"mr-2 h-4 w-4"})," Nova Pasta"]}),e.jsxs(j,{onClick:Oe,className:"flex-1 md:flex-none",children:[e.jsx(As,{className:"mr-2 h-4 w-4"})," Nova Rotina"]})]})]}),e.jsxs(Ms,{value:b,onValueChange:s=>i(s),className:"mb-6",children:[e.jsxs(Ts,{className:"grid w-full grid-cols-2",children:[e.jsx(fe,{value:"modelos",children:"Rotinas Modelo"}),e.jsx(fe,{value:"individuais",children:"Rotinas Individuais"})]}),e.jsx(ve,{value:"modelos",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ds,{type:"multiple",className:"w-full space-y-3",children:He.map(s=>e.jsxs(cs,{value:s._id,className:"border dark:border-slate-700 rounded-lg bg-white dark:bg-slate-800/50 shadow-sm",children:[e.jsxs(ms,{className:"px-4 py-3 hover:no-underline font-semibold text-lg",children:[e.jsxs("div",{className:"flex-grow flex items-center gap-3",children:[e.jsx(Ce,{className:"h-5 w-5 text-primary"})," ",s.nome," ",e.jsx(Q,{variant:"secondary",children:s.rotinas.length})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[e.jsx("span",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground h-7 w-7 cursor-pointer",onClick:a=>{a.stopPropagation(),ee(s)},title:"Editar Pasta",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx("span",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground h-7 w-7 text-red-500 cursor-pointer",onClick:a=>{a.stopPropagation(),$e(s)},title:"Excluir Pasta",children:e.jsx(ke,{className:"h-4 w-4"})})]})]}),e.jsx(us,{className:"p-4 border-t dark:border-slate-700",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 min-h-[50px]",children:s.rotinas.map(a=>e.jsx(K,{rotina:a,pastas:V,...B},a._id))})})]},s._id))}),oe.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 pt-4 border-t dark:border-slate-700",children:"Rotinas Sem Pasta"}),e.jsx("div",{className:"p-4 border-2 border-dashed dark:border-slate-700 rounded-lg min-h-[100px]",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:oe.map(s=>e.jsx(K,{rotina:s,pastas:V,...B},s._id))})})]})]})}),e.jsxs(ve,{value:"individuais",className:"mt-6",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Ne,{type:"search",placeholder:"Buscar por nome do aluno ou título da rotina...",className:"pl-9 w-full sm:w-96",value:E,onChange:s=>Ie(s.target.value)})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:ae.map(s=>{const a=I.find(n=>{var A;return n._id===(typeof s.alunoId=="string"?s.alunoId:(A=s.alunoId)==null?void 0:A._id)});return e.jsx(K,{rotina:s,pastas:[],alunoNome:a==null?void 0:a.nome,...B},s._id)})}),ae.length===0&&e.jsx("div",{className:"text-center text-muted-foreground col-span-full mt-10",children:e.jsx("p",{children:"Nenhuma rotina individual encontrada."})})]})]}),e.jsx(hs,{open:t,onClose:()=>u(!1),onSuccess:()=>{},alunos:I,rotinaParaEditar:x}),e.jsx(ps,{isOpen:d,onClose:()=>h(!1),rotina:p,onEdit:X,onAssign:Y,onPlayVideo:Ue,onConvertToModel:se}),m&&o&&e.jsx(Fs,{isOpen:m,onClose:()=>f(!1),fichaModeloId:o.id,fichaModeloTitulo:o.titulo}),e.jsx(Ds,{isOpen:v,onClose:()=>{g(!1),M(null)},onSuccessCallback:ze,initialData:y}),e.jsx(ce,{open:R,onOpenChange:s=>!s&&P(!1),children:e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Confirmar Exclusão"}),e.jsxs(he,{children:['Tem certeza que deseja excluir "',T==null?void 0:T.nome,'"?']})]}),e.jsxs(pe,{children:[e.jsx(ge,{children:"Cancelar"}),e.jsx(je,{onClick:Be,disabled:Z.isPending,className:"bg-red-600 hover:bg-red-700",children:"Confirmar"})]})]})}),e.jsx(ce,{open:Fe,onOpenChange:s=>!s&&q(!1),children:e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Tornar Rotina Modelo?"}),e.jsxs(he,{children:['Tem certeza que deseja criar uma cópia da rotina "',k==null?void 0:k.titulo,'" e transformá-la em uma rotina modelo? A rotina original permanecerá inalterada.']})]}),e.jsxs(pe,{children:[e.jsx(ge,{children:"Cancelar"}),e.jsxs(je,{onClick:Ge,disabled:$.isPending,children:[$.isPending&&e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar"]})]})]})}),e.jsx(Es,{videoUrl:Ee,onClose:()=>G(null)})]})}export{ra as default};
