import{c as h,r as d,j as e,n as p,M as F,Q as z,B as n,s as q,q as R,o as $,ag as V,L as _,m as b}from"./index-BzLV8CNE.js";import{u as H}from"./useQuery-PwrN8lgt.js";import{u as U}from"./useMutation-CMAM4n7S.js";import{T as Q,a as G,b as A,c,d as K,e as m}from"./table-C_2_dIR3.js";import{P as W,a as J,b as X}from"./popover-CWE9MTME.js";import{B as v}from"./badge-mwLuO-R-.js";import{A as Y,b as Z,c as ee,d as ae,e as re,f as se,g as te,h as ie}from"./alert-dialog-Cli0ldNh.js";import{L as le}from"./LoadingSpinner-CMtr6_ld.js";import{E as oe}from"./ErrorMessage-CKvNOnls.js";import{D as de,a as ne,b as ce,c as me,d as xe,e as ge}from"./dialog-Cc9arakq.js";import{S as w}from"./shield-check-7MDnEDak.js";import{C as k}from"./calendar-days-Degg0IRE.js";import{I as he}from"./info-CBDjHlMF.js";import{U as ye}from"./user-plus-leUCsTw7.js";import{E as ue}from"./eye-DbA9ViTj.js";import{S as je}from"./square-pen-DXG1TAJA.js";import{T as fe}from"./trash-2-CwwKKaCS.js";import"./triangle-alert-BMd-Rj3a.js";/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=h("BarChartHorizontalBig",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["rect",{width:"12",height:"4",x:"7",y:"5",rx:"1",key:"936jl1"}],["rect",{width:"7",height:"4",x:"7",y:"13",rx:"1",key:"jqfkpy"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=h("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=h("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=h("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),N=t=>{if(!t)return"N/A";try{const i=new Date(t);if(isNaN(i.getTime())){const a=String(t).split("/");if(a.length===3){const r=new Date(`${a[2]}-${a[1]}-${a[0]}`);if(!isNaN(r.getTime()))return r.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}return"Data inválida"}return i.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return String(t)}},l=({label:t,value:i,isMonospace:a,icon:r})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between py-2.5 border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center min-w-[160px] sm:min-w-fit mb-1 sm:mb-0",children:[r&&e.jsx("span",{className:"mr-2 shrink-0",children:r}),t,":"]}),e.jsx("dd",{className:`text-sm text-gray-900 dark:text-gray-100 sm:text-right ${a?"font-mono text-xs break-all":"break-words"}`,children:i??e.jsx("span",{className:"text-gray-400 dark:text-gray-500 italic",children:"Não informado"})})]});function pe({isOpen:t,onClose:i,personal:a,isLoading:r}){return d.useEffect(()=>(t&&console.log("%c[MODAL COMPONENT] Modal FOI MONTADO/ABERTO.","color: green; font-weight: bold;"),()=>{t&&console.log("%c[MODAL COMPONENT] Limpeza do efeito do modal. Próximo render ou desmontagem.","color: yellow;")}),[t]),e.jsx(de,{open:t,onOpenChange:i,children:e.jsxs(ne,{className:"sm:max-w-lg md:max-w-xl",children:[e.jsxs(ce,{children:[e.jsxs(me,{className:"flex items-center text-2xl",children:[e.jsx(T,{className:"mr-3 h-7 w-7 text-primary"}),"Detalhes do Personal Trainer"]}),a&&!r&&e.jsxs(xe,{children:["Informações detalhadas sobre ",a.nome,"."]})]}),r&&e.jsxs("div",{className:"py-12 flex flex-col justify-center items-center",children:[e.jsx(p,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("span",{className:"mt-3 text-gray-600 dark:text-gray-400",children:"Carregando detalhes..."})]}),!r&&a&&e.jsxs("div",{className:"py-4 space-y-1 max-h-[65vh] overflow-y-auto pr-3 -mr-3 custom-scrollbar",children:[e.jsx(l,{label:"Nome Completo",value:a.nome,icon:e.jsx(T,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})}),e.jsx(l,{label:"Email",value:a.email,icon:e.jsx(F,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})}),e.jsx(l,{label:"Função (Role)",icon:e.jsx(w,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"}),value:e.jsxs(v,{variant:a.role==="Admin"?"destructive":"default",className:`font-medium ${a.role==="Admin"?"bg-red-100 text-red-700 dark:bg-red-900/60 dark:text-red-300 border-red-300 dark:border-red-700":"bg-blue-100 text-blue-700 dark:bg-sky-900/60 dark:text-sky-300 border-blue-300 dark:border-sky-700"}`,children:[a.role==="Admin"&&e.jsx(w,{className:"mr-1.5 h-3.5 w-3.5"}),a.role]})}),e.jsx(l,{label:"Data de Cadastro",value:N(a.createdAt),icon:e.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})}),e.jsx(l,{label:"Última Atualização",value:N(a.updatedAt),icon:e.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})}),e.jsx("h3",{className:"text-md font-semibold pt-4 text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700 mt-4",children:"Assinatura"}),e.jsx(l,{label:"Status",icon:e.jsx(he,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"}),value:e.jsx(v,{variant:a.statusAssinatura==="ativa"?"success":"secondary",className:a.statusAssinatura==="ativa"?"bg-green-100 text-green-700 dark:bg-green-900/60 dark:text-green-300 border-green-300 dark:border-green-700":"bg-gray-100 text-gray-700 dark:bg-gray-700/60 dark:text-gray-300 border-gray-300 dark:border-gray-600",children:a.statusAssinatura||"Não definida"})}),e.jsx(l,{label:"Plano ID",value:a.planoId,icon:e.jsx(be,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})}),e.jsx(l,{label:"Limite de Alunos",value:a.limiteAlunos,icon:e.jsx(z,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})}),e.jsx(l,{label:"Fim da Assinatura",value:N(a.dataFimAssinatura),icon:e.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})}),a.tokenCadastroAluno&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-md font-semibold pt-4 text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700 mt-4",children:"Link de Cadastro de Alunos"}),e.jsx(l,{label:"Token",value:a.tokenCadastroAluno,isMonospace:!0,icon:e.jsx(Ne,{className:"h-4 w-4 text-gray-500 dark:text-gray-400"})})]})]}),!r&&!a&&t&&e.jsx("div",{className:"py-8 text-center text-gray-500 dark:text-gray-400",children:"Não foi possível carregar os dados do personal."}),e.jsx(ge,{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx(n,{variant:"outline",onClick:i,children:"Fechar"})})]})})}function $e(){const[,t]=q(),i=R(),{toast:a}=$(),[r,C]=d.useState(null),[L,x]=d.useState(!1),[P,y]=d.useState(!1),[E,u]=d.useState(null),[M,D]=d.useState(!1),{data:j,isLoading:S,error:g}=H({queryKey:["adminPersonalTrainersList"],queryFn:()=>b("GET","/api/admin/personal-trainers"),staleTime:1/0,refetchOnWindowFocus:!1}),o=U({mutationFn:s=>b("DELETE",`/api/admin/personal-trainers/${s}`),onSuccess:s=>{a({title:"Sucesso!",description:s.message||"Personal trainer excluído."}),i.invalidateQueries({queryKey:["adminPersonalTrainersList"]})},onError:s=>{a({variant:"destructive",title:"Erro ao Excluir",description:s.message||"Não foi possível excluir o personal trainer."})},onSettled:()=>{C(null),x(!1)}}),O=s=>{C(s),x(!0)},B=()=>{r&&o.mutate(r._id)},I=async s=>{D(!0),u(null),y(!0);try{const f=await b("GET",`/api/admin/personal-trainers/${s}`);u(f)}catch(f){a({variant:"destructive",title:"Erro ao buscar detalhes",description:f.message||"Não foi possível carregar os dados do personal."}),y(!1)}finally{D(!1)}};return S?e.jsx("div",{className:"flex h-[calc(100vh-150px)] items-center justify-center",children:e.jsx(le,{text:"Carregando lista de personais..."})}):g?e.jsx(oe,{title:"Erro ao Carregar Personais",message:(g==null?void 0:g.message)||"Não foi possível buscar a lista de personais."}):e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center",children:[e.jsx(V,{className:"mr-3 h-8 w-8 text-primary"}),"Gerenciar Personais"]}),e.jsx(_,{href:"/admin/criar-personal",children:e.jsxs(n,{children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Criar Novo Personal"]})})]}),j&&j.length>0?e.jsx("div",{className:"border rounded-lg shadow-sm overflow-hidden dark:border-gray-700",children:e.jsxs(Q,{children:[e.jsx(G,{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs(A,{children:[e.jsx(c,{className:"w-[250px] font-semibold text-gray-700 dark:text-gray-300",children:"Nome"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Função (Role)"}),e.jsx(c,{className:"font-semibold text-gray-700 dark:text-gray-300",children:"Data de Criação"}),e.jsx(c,{className:"text-right font-semibold text-gray-700 dark:text-gray-300",children:"Ações"})]})}),e.jsx(K,{children:j.map(s=>e.jsxs(A,{className:"dark:border-gray-700 hover:bg-gray-50/50 dark:hover:bg-gray-700/30",children:[e.jsx(m,{className:"font-medium text-gray-900 dark:text-gray-100",children:s.nome}),e.jsx(m,{className:"text-gray-600 dark:text-gray-300",children:s.email}),e.jsx(m,{children:e.jsxs(v,{variant:s.role.toLowerCase()==="admin"?"destructive":"outline",className:`font-medium ${s.role.toLowerCase()==="admin"?"border-red-500 text-red-600 bg-red-100 dark:bg-red-900/60 dark:text-red-300 dark:border-red-700":"border-blue-500 text-blue-600 bg-blue-100 dark:bg-sky-900/60 dark:text-sky-300 dark:border-sky-700"}`,children:[s.role.toLowerCase()==="admin"&&e.jsx(w,{className:"mr-1.5 h-3.5 w-3.5"}),s.role]})}),e.jsx(m,{className:"text-gray-600 dark:text-gray-300",children:new Date(s.createdAt).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsx(m,{className:"text-right",children:e.jsxs(W,{children:[e.jsx(J,{asChild:!0,children:e.jsxs(n,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(ke,{className:"h-4 w-4"})]})}),e.jsx(X,{className:"w-40 p-1",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs(n,{variant:"ghost",className:"w-full justify-start text-sm",onClick:()=>I(s._id),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"})," Visualizar"]}),e.jsxs(n,{variant:"ghost",className:"w-full justify-start text-sm",onClick:()=>t(`/admin/personais/editar/${s._id}`),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsx("div",{className:"border-t my-1"}),e.jsxs(n,{variant:"ghost",className:"w-full justify-start text-sm text-red-600 hover:text-red-700",onClick:()=>O(s),disabled:o.isPending&&(r==null?void 0:r._id)===s._id,children:[o.isPending&&(r==null?void 0:r._id)===s._id?e.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Excluir"]})]})})]})})]},s._id))})]})}):e.jsx("p",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"Nenhum personal trainer encontrado."}),e.jsx(Y,{open:L,onOpenChange:x,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(ae,{children:"Confirmar Exclusão"}),e.jsxs(re,{children:['Tem certeza que deseja excluir o personal trainer "',r==null?void 0:r.nome,'" (',r==null?void 0:r.email,")? Esta ação não pode ser desfeita."]})]}),e.jsxs(se,{children:[e.jsx(te,{onClick:()=>x(!1),disabled:o.isPending,children:"Cancelar"}),e.jsxs(ie,{onClick:B,disabled:o.isPending,className:"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800",children:[o.isPending&&e.jsx(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar Exclusão"]})]})]})}),e.jsx(pe,{isOpen:P,onClose:()=>{y(!1),u(null)},personal:E,isLoading:M})]})}export{$e as default};
