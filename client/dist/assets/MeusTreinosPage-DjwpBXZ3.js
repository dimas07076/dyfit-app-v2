import{ac as v,s as b,r as m,j as e,n as y,B as o,C as x,a as h,b as g,d as R,e as j,S as A,ae as C,m as S}from"./index-BzLV8CNE.js";import{P as E}from"./progress-37Updk6C.js";import{u as I}from"./useQuery-PwrN8lgt.js";import{T}from"./triangle-alert-BMd-Rj3a.js";import{A as _}from"./arrow-left-CY9mcJgZ.js";import{S as u}from"./star-Db543mjc.js";import{E as P}from"./eye-DbA9ViTj.js";import{p as k}from"./parseISO-ChxugJxP.js";import{f as D,i as $}from"./format-Cj1jUzCS.js";import{p as z}from"./pt-BR-C0EKqbj-.js";const K=()=>{const{aluno:a,tokenAluno:f}=v(),[,n]=b(),[i,d]=m.useState(()=>localStorage.getItem(`activeRotinaId_${a==null?void 0:a.id}`)),{data:r,isLoading:p,error:c}=I({queryKey:["minhasRotinasAluno",a==null?void 0:a.id],queryFn:async()=>{if(!(a!=null&&a.id))throw new Error("Aluno não autenticado.");return(await S("GET","/api/aluno/meus-treinos")).sort((t,l)=>new Date(l.atualizadoEm||l.criadoEm).getTime()-new Date(t.atualizadoEm||t.criadoEm).getTime())},enabled:!!a&&!!f});m.useEffect(()=>{if(r&&r.length>0){const s=r.some(t=>t._id===i);if(!i||!s){const t=r[0]._id;d(t),a!=null&&a.id&&localStorage.setItem(`activeRotinaId_${a.id}`,t)}}},[r,i,a==null?void 0:a.id]);const w=s=>{d(s),a!=null&&a.id&&localStorage.setItem(`activeRotinaId_${a.id}`,s)},N=s=>{if(!s)return"N/A";try{const t=k(s);return $(t)?D(t,"dd/MM/yyyy",{locale:z}):"Data inválida"}catch{return"Data inválida"}};return p?e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(y,{className:"h-10 w-10 animate-spin text-white mb-3"}),e.jsx("span",{className:"text-lg text-white",children:"Carregando suas rotinas..."})]})}):c?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-red-800/80 border border-red-500 text-white p-4 rounded-lg flex items-center",children:[e.jsx(T,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["Erro ao carregar rotinas: ",c.message]})]})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(o,{variant:"outline",size:"icon",className:"bg-white/20 hover:bg-white/30 border-white/50 text-white",onClick:()=>n("/aluno/dashboard"),children:e.jsx(_,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-white",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Minhas Rotinas de Treino"}),e.jsx("p",{className:"text-md opacity-90",children:"Veja todas as suas fichas e escolha qual deseja seguir."})]})]}),r&&r.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(s=>{const t=s._id===i,l=s.totalSessoesRotinaPlanejadas?s.sessoesRotinaConcluidas/s.totalSessoesRotinaPlanejadas*100:0;return e.jsxs(x,{className:`flex flex-col transition-all bg-white/95 backdrop-blur-sm text-gray-800 rounded-2xl shadow-lg border-2 ${t?"border-indigo-500":"border-transparent"}`,children:[e.jsxs(h,{children:[t&&e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-indigo-600 px-3 py-1 bg-indigo-100 rounded-full mb-2 w-fit-content",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:"Rotina Ativa"})]}),e.jsx(g,{className:"text-gray-900",children:s.titulo}),e.jsx(R,{children:s.descricao||"Sem descrição detalhada."})]}),e.jsxs(j,{className:"flex-grow space-y-3 text-sm text-gray-600",children:[s.totalSessoesRotinaPlanejadas!=null&&e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-xs mb-1 text-gray-700",children:["Progresso: ",e.jsx("strong",{children:s.sessoesRotinaConcluidas})," de ",e.jsx("strong",{children:s.totalSessoesRotinaPlanejadas})," sessões"]}),e.jsx(E,{value:l,className:"h-2"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Organização:"})," ",e.jsx("span",{className:"capitalize",children:s.tipoOrganizacaoRotina})]}),s.dataValidade&&e.jsxs("p",{children:[e.jsx("strong",{children:"Válida até:"})," ",N(s.dataValidade)]})]}),e.jsxs(A,{className:"flex flex-col sm:flex-row sm:flex-wrap justify-end gap-2 pt-4",children:[e.jsxs(o,{variant:"outline",className:"w-full sm:w-auto border-gray-300 text-gray-700 hover:bg-gray-100 hover:text-gray-900 rounded-lg",onClick:()=>n(`/aluno/ficha/${s._id}`),children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Ver Detalhes"]}),e.jsxs(o,{className:`w-full sm:w-auto rounded-lg ${t?"bg-gray-400":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,disabled:t,onClick:()=>w(s._id),children:[e.jsx(u,{className:`w-4 h-4 mr-2 ${t?"text-yellow-400 fill-current":""}`}),t?"Já está Ativa":"Tornar Ativa"]})]})]},s._id)})}):e.jsxs(x,{className:"bg-white/95 backdrop-blur-sm text-gray-800 rounded-2xl shadow-lg text-center py-12",children:[e.jsx(h,{children:e.jsx(g,{className:"flex justify-center items-center text-xl",children:e.jsx(C,{className:"w-8 h-8 mr-3 text-gray-400"})})}),e.jsxs(j,{children:[e.jsx("p",{className:"text-lg text-gray-600",children:"Nenhuma rotina de treino foi encontrada."}),e.jsx("p",{className:"text-sm mt-2",children:"Fale com seu personal trainer para criar uma ficha para você."})]})]})]})};export{K as default};
